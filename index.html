<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nour Maandhito | Marketing Property</title>

<style>
/* ================= ROOT ================= */
:root{
  --bg1:#0d0d10;
  --bg2:#1a1a1f;
  --bg3:#2a2a30;
  --card:rgba(255,255,255,.08);
  --glass:rgba(255,255,255,.14);
  --blur:blur(26px);
  --text:#fff;
  --muted:rgba(255,255,255,.7);
}

/* ================= GLOBAL ================= */
*{box-sizing:border-box}
html{scroll-behavior:smooth}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",sans-serif;
  color:var(--text);

  background:
    radial-gradient(1400px at 10% 10%, rgba(255,255,255,.22), transparent 60%),
    radial-gradient(1000px at 90% 15%, rgba(220,220,220,.14), transparent 55%),
    radial-gradient(900px at 50% 90%, rgba(255,255,255,.10), transparent 65%),
    linear-gradient(
      160deg,
      #0c0c0f,
      #151519,
      #1f1f24
    );

  background-attachment:fixed;
}

body::before{
  content:"";
  position:fixed;
  inset:-20%;
  background:
    radial-gradient(50% 40% at 30% 30%, rgba(255,255,255,.08), transparent 60%),
    radial-gradient(40% 50% at 70% 70%, rgba(255,255,255,.06), transparent 60%);
  animation:floatGlow 18s ease-in-out infinite alternate;
  pointer-events:none;
  z-index:-1;
}

@keyframes floatGlow{
  from{transform:translateY(-20px)}
  to{transform:translateY(20px)}
}

body::after{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  background:
    repeating-linear-gradient(
      45deg,
      rgba(255,255,255,.02),
      rgba(255,255,255,.02) 1px,
      transparent 1px,
      transparent 3px
    );
  mix-blend-mode:overlay;
  opacity:.18;
}

body.modal-open{overflow:hidden}

/* ================= NAV ================= */
nav{
  position:sticky;
  top:0;
  z-index:50;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 22px;
  background:rgba(0,0,0,.55);
  backdrop-filter:var(--blur);
  border-bottom:1px solid rgba(255,255,255,.08);
}

.nav-brand{
  display:flex;
  align-items:center;
  gap:10px;
}

.nav-brand img{
  width:38px;
  height:38px;
  object-fit:contain;
  opacity:.85;
}

nav a{
  color:var(--muted);
  margin-left:18px;
  text-decoration:none;
  font-size:14px;
}

/* ================= SECTION ================= */
section{
  padding:64px 6%;
}

/* ================= HERO ================= */
.hero{
  min-height:85vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
}

.hero h1{
  font-size:42px;
  margin-bottom:14px;
}

.hero p{
  max-width:620px;
  color:var(--muted);
  margin-bottom:26px;
}

/* ================= BUTTON ================= */
.btn{
  padding:14px 28px;
  border-radius:30px;
  border:1px solid rgba(255,255,255,.35);
  color:white;
  text-decoration:none;
  cursor:pointer;
  backdrop-filter:blur(6px);
}

.btn.primary{
  background:white;
  color:black;
}

/* ================= PROJECT ================= */
.project-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:22px;
}

.project-card{
  padding:26px 22px;
  border-radius:18px;
  background:rgba(255,255,255,.08);
  backdrop-filter:var(--blur);
  border:1px solid rgba(255,255,255,.15);
  transition:.35s ease;
  cursor:pointer;
}

.project-card:hover{
  transform:translateY(-6px);
  box-shadow:0 12px 40px rgba(0,0,0,.4);
}

/* LOGO DI KANAN PROJECT (TANPA JS) */
.project-card::after{
  content:"";
  position:absolute;
  top:18px;
  right:18px;
  width:34px;
  height:34px;
  background:url("assets/logo-mark.png") center/contain no-repeat;
  opacity:.55;
}

/* ================= PROJECT STATUS ================= */
.status{
  position:absolute;
  top:18px;
  left:18px;
  padding:6px 14px;
  border-radius:20px;
  font-size:11px;
  font-weight:600;
  letter-spacing:.5px;
  backdrop-filter:blur(8px);
  border:1px solid rgba(255,255,255,.35);
}

/* READY */
.status.ready{
  background:rgba(45, 220, 120, .25);
  color:#baffd9;
  box-shadow:0 0 18px rgba(45,220,120,.25);
}

/* BOOKING */
.status.booking{
  background:rgba(255, 180, 60, .25);
  color:#ffe2a8;
  box-shadow:0 0 18px rgba(255,180,60,.25);
}

/* SOLD */
.status.sold{
  background:rgba(255, 80, 80, .22);
  color:#ffc1c1;
  box-shadow:0 0 18px rgba(255,80,80,.22);
  opacity:.85;
}

.project-card:has(.status.sold){
  opacity:.75;
}

/* ================= SOFT GLOW PROJECT ================= */
.project-card{
  transition:
    transform .35s ease,
    box-shadow .35s ease,
    background .35s ease;
}

/* READY GLOW */
.project-card:hover .status.ready{
  box-shadow:
    0 0 22px rgba(45,220,120,.35),
    inset 0 0 12px rgba(45,220,120,.25);
}

/* BOOKING GLOW */
.project-card:hover .status.booking{
  box-shadow:
    0 0 22px rgba(255,180,60,.35),
    inset 0 0 12px rgba(255,180,60,.25);
}

/* SOLD ‚Äì glow lebih redup */
.project-card:hover .status.sold{
  box-shadow:
    0 0 14px rgba(255,80,80,.25),
    inset 0 0 8px rgba(255,80,80,.18);
}

/* OPTIONAL: subtle outline glow ke card */
.project-card:hover{
  box-shadow:
    0 0 0 1px rgba(255,255,255,.18),
    0 12px 30px rgba(0,0,0,.45);
}

.status{
  text-shadow:0 0 8px rgba(255,255,255,.25);
}

/* ================= CONTACT ================= */
#contact{text-align:center}

.contact-icons{
  display:flex;
  justify-content:center;
  gap:14px;
  margin-top:20px;
}

.contact-icons a{
  width:42px;
  height:42px;
  border-radius:50%;
  background:var(--card);
  display:flex;
  align-items:center;
  justify-content:center;
}

.contact-icons img{
  width:18px;
  filter:invert(1);
}

/* ================= FOOTER ================= */
footer{
  text-align:center;
  padding:26px 16px;
  color:var(--muted);
  font-size:13px;
}

/* ================= MODAL ================= */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(12px);
  display:none;
  z-index:100;
}
.modal.active{display:block}

.sheet{
  position:absolute;
  left:50%;
  bottom:0;
  width:100%;
  max-width:820px;
  background:linear-gradient(
    180deg,
    rgba(255,255,255,.18),
    rgba(255,255,255,.08)
  );
  backdrop-filter:var(--blur);
  border-radius:28px 28px 0 0;
  transform:translate(-50%,100%);
  transition:.55s cubic-bezier(.22,.61,.36,1);
}
.modal.active .sheet{transform:translate(-50%,0)}

.sheet-handle{
  width:44px;
  height:5px;
  background:rgba(255,255,255,.45);
  border-radius:10px;
  margin:12px auto;
}

.close{
  position:absolute;
  top:14px;
  right:18px;
  font-size:26px;       /* lebih gede */
  width:40px;
  height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  background:rgba(255,255,255,.15);
  cursor:pointer;
}

.sheet-body{
  max-height:78vh;
  overflow-y:auto;
  padding:0 24px 36px;
}

/* ================= ACTION BAR ================= */
.action-bar{
  display:flex;
  gap:12px;
  margin:22px 0;
}

.action-btn{
  flex:1;
  background:rgba(255,255,255,.14);
  border:1px solid rgba(255,255,255,.25);
  border-radius:18px;
  padding:14px 0;
  color:white;
  font-size:14px;
  font-weight:500;
  cursor:pointer;
}

/* ================= MEDIA POPUP ================= */
.media-popup{
  pointer-events:auto;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  backdrop-filter:blur(14px);
  display:none;
  z-index:200;
}
.media-popup.active{
  display:flex;
  align-items:flex-end;
}

.media-sheet{
  width:100%;
  max-width:900px;
  margin:auto;
  background:var(--glass);
  backdrop-filter:var(--blur);
  border-radius:28px 28px 0 0;
  padding:20px;
}

.media-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(110px,1fr));
  gap:12px;
  max-height:70vh;
  overflow:auto;
}

.media-grid img,
.media-grid video{
  width:100%;
  border-radius:14px;
  object-fit:cover;
}

.media-header{
  position:relative;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 6px 14px;
  z-index:5;
}

.media-close{
  font-size:28px;
  width:40px;
  height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  background:rgba(255,255,255,.18);
  cursor:pointer;

  pointer-events:auto;   /* üî• penting */
  z-index:10;
}

/* ================= FULLSCREEN ================= */
.fullscreen{
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle at center, #111 0%, #000 70%);
  display:none;
  z-index:9999;
  overflow:hidden;
}

.fullscreen.active{
  display:block;
}

/* TRACK */
#fsTrack{
  display:flex;
  width:100vw;
  height:100vh;
  flex-direction:row;
  touch-action:pan-y;
  transition:transform .3s ease;
}

/* ITEM */
.fs-item{
  width:100vw;        /* üî• WAJIB */
  height:100vh;       /* üî• WAJIB */
  flex-shrink:0;      /* üî• WAJIB */
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
}

/* MEDIA */
.fs-item img,
.fs-item video{
  max-width:100%;
  max-height:100%;
  object-fit:contain;
  background:#000;
}


}

.fs-dots{
  position:absolute;
  bottom:22px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:8px;
  opacity:0;
  transition:opacity .35s ease;
  pointer-events:none;
}

.fs-dots.show{
  opacity:1;
}

.fs-dots span{
  width:7px;
  height:7px;
  border-radius:50%;
  background:rgba(255,255,255,.35);
}
.fs-dots span.active{
  background:white;
}

/* ================= SPLASH ================= */
.splash{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  backdrop-filter:blur(14px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.splash.active{display:flex}

.loader{
  width:36px;
  height:36px;
  border:3px solid rgba(255,255,255,.2);
  border-top-color:white;
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

@media(max-width:600px){
  .hero h1{font-size:32px}
}

.fs-header span{
  position:absolute;
  top:18px;
  right:20px;
  font-size:32px;        /* sebelumnya kecil */
  width:42px;
  height:42px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  background:rgba(255,255,255,.15);
  cursor:pointer;
}

/* === FIX CLOSE FULLSCREEN IOS === */
.fs-header{
  position:fixed;
  top:0;
  right:0;
  z-index:10000;
  pointer-events:none;
}

.fs-close{
  pointer-events:auto;
  z-index:10001;
}

/* media JANGAN tangkap tap */
.fullscreen.active img,
.fullscreen.active video{
  pointer-events:none;
}

/* ================= WHY SECTION ================= */
.why{
  text-align:center;
}

.why h2{
  font-size:28px;
  margin-bottom:10px;
}

.why-desc{
  max-width:680px;
  margin:0 auto 36px;
  color:var(--muted);
  font-size:15px;
}

.why-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:22px;
}

.why-card{
  background:linear-gradient(
    180deg,
    rgba(255,255,255,.14),
    rgba(255,255,255,.06)
  );
  backdrop-filter:var(--blur);
  border-radius:22px;
  padding:26px 20px;
  text-align:left;
  transition:.35s ease;
}

.why-card strong{
  display:block;
  font-size:15px;
  margin-bottom:6px;
}

.why-card span{
  font-size:13px;
  color:var(--muted);
  line-height:1.5;
}

.why-card:hover{
  transform:translateY(-6px);
  background:rgba(255,255,255,.18);
}

/* ================= WA STICKY CTA ================= */
.wa-sticky{
  position:fixed;
  bottom:18px;
  right:18px;
  z-index:80;
  opacity:0;
  transform:translateY(20px);
  transition:.45s cubic-bezier(.22,.61,.36,1);
}

.wa-sticky.show{
  opacity:1;
  transform:translateY(0);
}

.wa-sticky a{
  display:flex;
  align-items:center;
  gap:10px;
  padding:14px 18px;
  border-radius:28px;
  text-decoration:none;
  color:#eafff4;
  font-size:14px;
  font-weight:500;

  background:linear-gradient(
    180deg,
    rgba(45,220,120,.35),
    rgba(25,160,85,.25)
  );

  backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,.35);

  box-shadow:
    0 0 24px rgba(45,220,120,.35),
    0 12px 28px rgba(0,0,0,.45);
}

.wa-icon{
  font-size:18px;
}

.wa-sticky a:hover{
  transform:translateY(-2px);
}

/* Hanya mobile */
@media(min-width:900px){
  .wa-sticky{display:none}
}

/* ================= PROJECT FILTER ================= */
.project-filter{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin:22px 0 32px;
}

.filter-btn{
  padding:10px 18px;
  border-radius:20px;
  font-size:13px;
  font-weight:500;
  color:var(--muted);
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.2);
  backdrop-filter:var(--blur);
  cursor:pointer;
  transition:.3s ease;
}

.filter-btn.active{
  color:white;
  background:rgba(255,255,255,.22);
  box-shadow:0 0 18px rgba(255,255,255,.25);
}

.filter-btn:hover{
  transform:translateY(-2px);
}

.cicilan-box{
  margin-top:24px;
  padding:18px;
  border-radius:16px;
  background:rgba(255,255,255,.06);
}

.cicilan-box label{
  display:block;
  font-size:12px;
  opacity:.7;
  margin-top:12px;
}

.cicilan-box input,
.cicilan-box select{
  width:100%;
  margin-top:6px;
}

.cicilan-result{
  margin-top:16px;
  font-size:14px;
}

.btn-wa{
  display:block;
  margin-top:24px;
  text-align:center;
  padding:14px;
  border-radius:30px;
  background:#25d366;
  color:#000;
  font-weight:600;
}

/* ===== TENOR SELECT PREMIUM ===== */
.tenor-select{
  position:relative;
  margin-top:6px;
  font-family:inherit;
}

/* DISPLAY */
.tenor-display{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
  border-radius:14px;
  background:rgba(20,20,20,.75);
  backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,.08);
  cursor:pointer;
  transition:.25s ease;
  box-shadow:0 0 0 rgba(0,255,180,0);
}

.tenor-display:hover{
  border-color:rgba(0,255,180,.4);
}

.tenor-select.open .tenor-display{
  box-shadow:0 0 18px rgba(0,255,180,.35);
}

.chevron{
  font-size:18px;
  transition:.25s;
}

.tenor-select.open .chevron{
  transform:rotate(180deg);
}

/* OPTIONS */
.tenor-options{
  position:absolute;
  inset:auto 0 0 0;
  top:110%;
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px;
  padding:12px;
  border-radius:18px;
  background:rgba(10,10,10,.9);
  backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,.08);
  opacity:0;
  transform:translateY(-10px) scale(.96);
  pointer-events:none;
  transition:.25s ease;
  z-index:30;
}

.tenor-select.open .tenor-options{
  opacity:1;
  transform:translateY(0) scale(1);
  pointer-events:auto;
}

/* OPTION PILL */
.tenor-option{
  padding:12px 10px;
  text-align:center;
  border-radius:999px;
  background:#161616;
  cursor:pointer;
  transition:.2s;
}

.tenor-option:hover{
  background:#222;
}

.tenor-option.active{
  background:linear-gradient(135deg,#00ffc6,#00bfa5);
  color:#000;
  font-weight:600;
  box-shadow:0 0 14px rgba(0,255,180,.6);
}

</style>
</head>

<body>

<nav>
  <div class="nav-brand">
    <img src="assets/logo.PNG" alt="Logo">
    <strong>Dhito Property</strong>
  </div>
  <div>
    <a href="#home">Home</a>
    <a href="#project">Project</a>
    <a href="#contact">Kontak</a>
  </div>
</nav>

<section id="home" class="hero">
  <h1>Marketing Property Profesional & Terpercaya</h1>
  <p>Membantu Anda mendapatkan rumah impian dengan proses aman dan transparan.</p>
  <a href="#project" class="btn primary">Lihat Project</a>
</section>

<section id="why" class="why">
  <h2>Kenapa Dhito Property?</h2>
  <p class="why-desc">
    Kami tidak hanya menjual rumah, tapi mendampingi Anda dari awal hingga serah terima dengan proses yang aman dan transparan.
  </p>

  <div class="why-grid">
    <div class="why-card">
      <strong>Legal Aman</strong>
      <span>Sertifikat & dokumen jelas</span>
    </div>

    <div class="why-card">
      <strong>Proses Transparan</strong>
      <span>Harga & info tanpa ditutup-tutupi</span>
    </div>

    <div class="why-card">
      <strong>Pendampingan Penuh</strong>
      <span>Dari survey sampai akad</span>
    </div>

    <div class="why-card">
      <strong>After Sales</strong>
      <span>Tetap dibantu setelah serah terima</span>
    </div>
  </div>
</section>

<section id="project">
  <h2>Project Rumah</h2>
  <div class="project-filter">
  <button class="filter-btn active" data-filter="all">Semua</button>
  <button class="filter-btn" data-filter="ready">Ready</button>
  <button class="filter-btn" data-filter="booking">Booking</button>
  <button class="filter-btn" data-filter="sold">Sold</button>
</div>
  <div id="projectGrid" class="project-grid"></div>
</section>

<section id="contact">
  <h2>Hubungi Saya</h2>
  <div class="contact-icons">
    <a href="https://wa.me/6281802168184"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/whatsapp.svg"></a>
    <a href="https://instagram.com/dhitoproperty.id"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg"></a>
    <a href="https://www.tiktok.com/@dhitopropertyid"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg"></a>
    <a href="mailto:dhitoproperty@gmail.com"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/gmail.svg"></a>
  </div>
</section>

<footer>¬© 2026 Nour Maandhito ‚Äî Marketing Property</footer>

<!-- MODAL -->
<div id="modal" class="modal">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <span class="close" onclick="closeModal()">‚úï</span>
    <div class="sheet-body" id="modalBody"></div>
  </div>
</div>

<!-- MEDIA POPUP -->
<div id="mediaPopup" class="media-popup">
  <div class="media-sheet">
    <div class="media-header">
      <strong id="mediaTitle">Preview</strong>
      <span class="media-close" onclick="closeMedia()">‚úï</span>
    </div>
    <div id="mediaGrid" class="media-grid"></div>
  </div>
</div>

<!-- FULLSCREEN VIEWER -->
<div id="fullscreen" class="fullscreen">
  <div id="fsDots" class="fs-dots"></div>
  <div class="fs-header">
    <span class="fs-close" onclick="closeFullscreen(event)">‚úï</span>
  </div>
  <div id="fsTrack" class="fs-track"></div>
</div>

<div id="splash" class="splash">
  <div class="loader"></div>
</div>

<!-- SsTICKY WHATSAPP CTA -->
<div id="waSticky" class="wa-sticky">
  <a id="waStickyLink" target="_blank">
    <span class="wa-icon">üí¨</span>
    <span class="wa-text">Chat WhatsApp</span>
  </a>
</div>

<script>
/* =========================
   GLOBAL STATE
   ========================= */
let projects = [];
let currentProject = null;

let fsIndex = 0;
let fsItems = [];
let dotsTimer = null;


/* =========================
   FETCH & RENDER PROJECT
   ========================= */
fetch("projects.json")
  .then(r => r.json())
  .then(d => {
    projects = d;
    renderProjects();
  });

function renderProjects(){
  const grid = document.getElementById("projectGrid");
  grid.innerHTML = "";

  projects.forEach((p,i)=>{
    const card = document.createElement("div");
    card.className = "project-card";
    card.innerHTML = `
      <span class="status ${p.status || 'ready'}">
        ${(p.status || 'READY').toUpperCase()}
      </span>
      <h3>${p.name}</h3>
    `;
    card.onclick = ()=> openModal(i);
    grid.appendChild(card);
  });
}

/* =========================
   UTILITIES
   ========================= */
function getSrc(file){
  return file.startsWith("http")
    ? file
    : currentProject.folder + file;
}

function generateWA(projectName){
  return `https://wa.me/6281802168184?text=${encodeURIComponent(
    `Halo, saya telah melihat website Dhito Property dan tertarik dengan project ${projectName}.`
  )}`;
}

function showSplash(){
  document.getElementById("splash").classList.add("active");
}

function hideSplash(){
  document.getElementById("splash").classList.remove("active");
}

function enableZoom(img){
  let zoomed = false;
  img.ondblclick = ()=>{
    zoomed = !zoomed;
    img.style.transform = zoomed ? "scale(2)" : "scale(1)";
  };
}


/* =========================
   MODAL OPEN (UPGRADED)
   ========================= */
function openModal(i){
  const p = projects[i];
  currentProject = p;

  document.body.classList.add("modal-open");
  document.getElementById("modal").classList.add("active");

  document.getElementById("modalBody").innerHTML = `
    <h2>${p.name}</h2>

    <span class="status ${p.status || 'ready'}">
      ${(p.status || 'READY').toUpperCase()}
    </span>

    <p class="muted">
      üìç ${p.location}
    </p>

    ${p.description ? `<p>${p.description}</p>` : ""}

    <!-- PRICE -->
    <div class="price-box">
      <strong>${p.price}</strong>
    </div>

    <!-- SIMULASI CICILAN -->
    <div class="cicilan-box">
      <h4>Simulasi Cicilan</h4>

      <label>DP (<span id="dpValue">20%</span>)</label>
      <input type="range" id="dpRange" min="5" max="50" value="25">

<label>Tenor</label>
<div class="tenor-select" id="tenorSelect" data-value="15">
  <div class="tenor-display">
    <span id="tenorLabel">15 Tahun</span>
    <span class="chevron">‚åÑ</span>
  </div>

  <div class="tenor-options">
    <div class="tenor-option" data-value="10">10 Tahun</div>
    <div class="tenor-option active" data-value="15">15 Tahun</div>
    <div class="tenor-option" data-value="20">20 Tahun</div>
    <div class="tenor-option" data-value="25">25 Tahun</div>
  </div>
</div>
      <div class="cicilan-result">
        Estimasi Cicilan:
        <strong id="cicilanValue">-</strong> / bulan
      </div>
    </div>

    ${p.nearby?.length ? `
      <h4>Lokasi Terdekat</h4>
      <ul>${p.nearby.map(n=>`<li>${n}</li>`).join("")}</ul>
    ` : ""}

    <div class="action-bar">
      <button class="action-btn" onclick="showGallery()">Lihat Foto</button>
      <button class="action-btn" onclick="showVideo()">Lihat Video</button>
    </div>

    <div class="gallery" id="gallery">
      ${(p.images||[]).map(img=>`<img data-src="${img}">`).join("")}
    </div>

    <div class="video-box" id="videoBox"></div>

    <div class="cta-group bottom">
      <a href="${p.mapLink}" target="_blank" class="btn">Google Maps</a>
      <a id="modalWA" target="_blank" class="btn primary">Hubungi Wa</a>
    </div>
  `;

  initSwipe();
  initCicilan();
}

function initCicilan(){
  const dpRange   = document.getElementById("dpRange");
  const dpValue   = document.getElementById("dpValue");
  const cicilanEl = document.getElementById("cicilanValue");
  const waBtn     = document.getElementById("modalWA");

  /* ===== TENOR CUSTOM SELECT ===== */
  const select    = document.getElementById("tenorSelect");
  const display   = select.querySelector(".tenor-display");
  const label     = document.getElementById("tenorLabel");
  const options   = select.querySelectorAll(".tenor-option");

  let tenorYear = parseInt(select.dataset.value) || 15;

  /* open / close select */
  display.addEventListener("click", ()=>{
    select.classList.toggle("open");
  });

  /* pilih tenor */
  options.forEach(opt=>{
    opt.addEventListener("click", ()=>{
      options.forEach(o=>o.classList.remove("active"));
      opt.classList.add("active");

      tenorYear = parseInt(opt.dataset.value);
      select.dataset.value = tenorYear;
      label.textContent = opt.textContent;

      select.classList.remove("open");
      hitung();
    });
  });

  /* klik di luar = close */
  document.addEventListener("click", e=>{
    if(!select.contains(e.target)){
      select.classList.remove("open");
    }
  });

  /* ===== HITUNG CICILAN ===== */
  function hitung(){
    const price = currentProject.priceValue;
    if(!price) return;

    const dpPercent = dpRange.value / 100;
    const tenor     = tenorYear * 12;
    const bunga     = 0.10 / 12; // estimasi 10% / tahun

    const loan = price * (1 - dpPercent);

    const angs =
      (loan * bunga) /
      (1 - Math.pow(1 + bunga, -tenor));

    dpValue.textContent = dpRange.value + "%";
    cicilanEl.textContent =
      "Rp " + Math.round(angs).toLocaleString("id-ID");

    waBtn.href =
      `https://wa.me/6281802168184?text=${encodeURIComponent(
        `Halo, saya tertarik dengan ${currentProject.name}
DP ${dpRange.value}% ‚Ä¢ Tenor ${tenorYear} tahun
Estimasi cicilan ${cicilanEl.textContent}`
      )}`;
  }

  dpRange.addEventListener("input", hitung);

  /* init pertama */
  hitung();
}

/* =========================
   MEDIA ENTRY POINT
   ========================= */
function showGallery(){
  openMedia("photo");
}

function showVideo(){
  openMedia("video");
}


/* =========================
   MEDIA POPUP
   ========================= */
function openMedia(type){
  const popup = document.getElementById("mediaPopup");
  const grid  = document.getElementById("mediaGrid");
  const title = document.getElementById("mediaTitle");

  grid.innerHTML = "";
  title.innerText = type === "photo" ? "Foto Project" : "Video Project";

  const files = (currentProject.media || [])
    .filter(f => type === "photo" ? isImage(f) : isVideo(f));

  files.forEach((file,i)=>{
    const fullPath = getSrc(file);
    let el;

    if(type === "photo"){
      el = document.createElement("img");
      el.src = fullPath;
      el.addEventListener("click",()=>{
        openFullscreen("photo", i, files);
      });
    } else {
      el = document.createElement("video");
      el.src = fullPath;
      el.controls = false;
      el.poster = "";
      el.preload = "metadata";
      el.playsInline = false;
      el.muted = false;
      el.style.width = "100%";
      el.style.background = "#000";

      el.addEventListener("click",()=>{
        el.play().then(()=>{
          if(el.webkitEnterFullscreen){
            el.webkitEnterFullscreen();
          } else if(el.requestFullscreen){
            el.requestFullscreen();
          }
        }).catch(()=>{});
      });
    }

    grid.appendChild(el);
  });

  popup.classList.add("active");
}

function closeMedia(e){
  if(e){
    e.preventDefault();
    e.stopPropagation();
  }

  const popup = document.getElementById("mediaPopup");
  const grid  = document.getElementById("mediaGrid");

  popup.classList.remove("active");
  setTimeout(()=>grid.innerHTML="",200);
}

document.querySelector(".media-sheet").addEventListener("click",e=>{
  e.stopPropagation();
});


/* =========================
   MODAL CLOSE & SWIPE
   ========================= */
function closeModal(){
  const sheet = document.querySelector(".sheet");
  sheet.style.transform = "translate(-50%,100%)";

  setTimeout(()=>{
    document.getElementById("modal").classList.remove("active");
    document.body.classList.remove("modal-open");
    sheet.style.transform = "";
  },350);
}

function initSwipe(){
  const sheet = document.querySelector(".sheet");
  const body  = document.querySelector(".sheet-body");

  let startY = 0;
  let currentY = 0;
  let dragging = false;

  sheet.addEventListener("touchstart",e=>{
    if(body.scrollTop === 0){
      startY = e.touches[0].clientY;
      dragging = true;
      sheet.style.transition = "none";
    }
  });

  sheet.addEventListener("touchmove",e=>{
    if(!dragging) return;
    currentY = e.touches[0].clientY;
    const diff = currentY - startY;
    if(diff > 0){
      sheet.style.transform = `translate(-50%,${diff * 0.6}px)`;
    }
  });

  sheet.addEventListener("touchend",()=>{
    if(!dragging) return;
    dragging = false;
    sheet.style.transition = "transform .45s cubic-bezier(.22,.61,.36,1)";
    const diff = currentY - startY;
    diff > 180 ? closeModal() : sheet.style.transform = "translate(-50%,0)";
  });
}


/* =========================
   FULLSCREEN SLIDER
   ========================= */
const fullscreenEl = document.getElementById("fullscreen");

fullscreenEl.addEventListener("click",e=>{
  if(e.target.closest(".fs-close")) return;
  if(!e.target.closest(".fs-item")) return;
  showDots();
});

const IMAGE_EXT = /\.(jpg|jpeg|png|webp|gif)$/i;
const VIDEO_EXT = /\.(mp4|webm|ogg|mov)$/i;

function isImage(src){
  return IMAGE_EXT.test(src.toLowerCase());
}

function isVideo(src){
  return VIDEO_EXT.test(src.toLowerCase()) || src.includes("cloudinary.com");
}

function showDots(){
  const dots = document.getElementById("fsDots");
  dots.classList.add("show");

  clearTimeout(dotsTimer);
  dotsTimer = setTimeout(()=>{
    dots.classList.remove("show");
  },1800);
}

function updateDots(){
  document.querySelectorAll(".fs-dots span").forEach((d,i)=>{
    d.classList.toggle("active", i === fsIndex);
  });
  showDots();
}

function openFullscreen(type,start,files){
  showSplash();

  const fs    = document.getElementById("fullscreen");
  const track = document.getElementById("fsTrack");
  const dots  = document.getElementById("fsDots");

  track.innerHTML = "";
  dots.innerHTML  = "";

  fsItems = files;
  fsIndex = start;

  files.forEach((file,i)=>{
    const wrap = document.createElement("div");
    wrap.className = "fs-item";
    const src = getSrc(file);

    if(type === "photo"){
      const img = document.createElement("img");
      img.src = src;
      enableZoom(img);
      wrap.appendChild(img);
    } else {
      const v = document.createElement("video");
      v.src = src;
      v.preload = "auto";
      v.playsInline = false;
      v.controls = false;
      wrap.appendChild(v);

      if(i === fsIndex){
        setTimeout(()=>v.play().catch(()=>{}),200);
      }
    }

    track.appendChild(wrap);

    const dot = document.createElement("span");
    if(i === fsIndex) dot.classList.add("active");
    dots.appendChild(dot);
  });

  track.style.transition = "none";
  track.style.transform  = `translateX(-${fsIndex * 100}%)`;

  fs.classList.add("active");

  initFullscreenSwipe(type);
  updateDots();

  setTimeout(hideSplash,300);
}

function closeFullscreen(e){
  if(e){
    e.preventDefault();
    e.stopImmediatePropagation();
  }
  document.querySelectorAll(".fs-item video").forEach(v=>v.pause());
  const fs = document.getElementById("fullscreen");
  fs.classList.remove("active");
  document.getElementById("fsTrack").style.transform = "";
}

function initFullscreenSwipe(type){
  const track = document.getElementById("fsTrack");

  let startX = 0;
  let diffX  = 0;
  let dragging = false;

  track.onpointerdown = e=>{
    dragging = true;
    startX = e.clientX;
    diffX  = 0;
    track.setPointerCapture(e.pointerId);
    track.style.transition = "none";
  };

  track.onpointermove = e=>{
    if(!dragging) return;
    diffX = e.clientX - startX;
    track.style.transform =
      `translateX(calc(-${fsIndex * 100}% + ${diffX}px))`;
  };

  track.onpointerup = ()=>{
    dragging = false;
    track.style.transition = "transform .35s cubic-bezier(.22,.61,.36,1)";

    if(diffX < -80 && fsIndex < fsItems.length - 1) fsIndex++;
    if(diffX >  80 && fsIndex > 0) fsIndex--;

    track.style.transform = `translateX(-${fsIndex * 100}%)`;
    updateDots();
  };

  track.onpointercancel = track.onpointerup;
}

/* ================= PROJECT FILTER LOGIC ================= */
const filterButtons = document.querySelectorAll(".filter-btn");

filterButtons.forEach(btn=>{
  btn.addEventListener("click",()=>{
    filterButtons.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");

    const type = btn.dataset.filter;
    applyProjectFilter(type);
  });
});

function applyProjectFilter(type){
  const grid = document.getElementById("projectGrid");
  grid.innerHTML = "";

  const filtered =
    type === "all"
      ? projects
      : projects.filter(p => (p.status || "ready") === type);

  filtered.forEach((p,i)=>{
    const card = document.createElement("div");
    card.className = "project-card";
    card.innerHTML = `
      <span class="status ${p.status || 'ready'}">${(p.status || 'READY').toUpperCase()}</span>
      <h3>${p.name}</h3>
    `;
    card.onclick = () => openModal(projects.indexOf(p));
    grid.appendChild(card);
  });
}

window.addEventListener("scroll",()=>{
  if(window.scrollY < 80){
    const defaultFilter =
      document.querySelector('.filter-btn[data-filter="all"]');
    if(defaultFilter && !defaultFilter.classList.contains("active")){
      defaultFilter.click();
    }
  }
});

/* ================= WA STICKY BEHAVIOR (IMPROVED) ================= */
let lastScrollY = window.scrollY;
const waSticky = document.getElementById("waSticky");
const waLink   = document.getElementById("waStickyLink");

function updateWAContext(){
  const text = currentProject
    ? `Halo, saya tertarik dengan project ${currentProject.name}.`
    : `Halo, saya ingin tanya info rumah.`;

  waLink.href =
    `https://wa.me/6281802168184?text=${encodeURIComponent(text)}`;
}

window.addEventListener("scroll",()=>{
  const currentY = window.scrollY;
  const trigger  = window.innerHeight * 0.6; // üî• muncul lebih awal

  if(currentY > trigger && currentY < lastScrollY){
    waSticky.classList.add("show");
  }else{
    waSticky.classList.remove("show");
  }

  lastScrollY = currentY;
});

document.addEventListener("click", updateWAContext);
</script>
</body>
</html>